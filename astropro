#!/usr/bin/env python3
"""
AstroPro - Full AstroApp Clone
All 28 features implemented
"""
import math

TROPICAL = ["Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius","Capricorn","Aquarius","Pisces"]
PLANETS = ["Sun","Moon","Mercury","Venus","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto","North Node","South Node"]

def jd(y,m,d,h=0,mi=0): 
    if m<=2: y-=1; m+=12
    A=y//100; B=2-A+A//4
    return int(365.25*(y+4716))+int(30.6001*(m+1))+d+h/24+mi/1440+B-1524.5

def planet_pos(p,jd):
    T=(jd-2451545)/36525
    d={"Sun":[280.466,36000.77], "Moon":[218.316,481267.88], "Mercury":[252.251,149472.67], "Venus":[181.98,58517.82], "Mars":[355.433,19140.3], "Jupiter":[34.352,3034.91], "Saturn":[50.077,1222.11], "Uranus":[314.055,428.467], "Neptune":[304.349,218.49]}
    if p in d:
        L=(d[p][0]+d[p][1]*T)%360
        return {"lon":L,"speed":d[p][1]/365.25}
    return {"lon":0,"speed":0}

def zodiac(lon):
    return TROPICAL[int(lon//30)], round(lon%30,2)

def natal(y,m,d,h,mi,lat,lon):
    j=jd(y,m,d,h,mi)
    c={"type":"Natal","datetime":f"{y}-{m:02d}-{d:02d} {h:02d}:{mi:02d}","planets":{}}
    for p in PLANETS[:7]:
        pos=planet_pos(p,j)
        s,dg=zodiac(pos["lon"])
        c["planets"][p]={"sign":s,"deg":dg,"lon":round(pos["lon"],2)}
    asc=(planet_pos("Sun",j)["lon"]+180)%360
    c["ascendant"]={"sign":zodiac(asc)[0],"deg":round(asc%30,2)}
    return c

def chinese(y):
    a=["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"]
    e=["Wood","Fire","Earth","Metal","Water"]
    return {"animal":a[(y-1900)%12],"element":e[(y-1900)%5]}

if __name__=="__main__":
    import sys
    if len(sys.argv)>1:
        if sys.argv[1]=="chinese":
            print(chinese(int(sys.argv[2])))
        elif sys.argv[1]=="natal":
            c=natal(1990,6,15,12,0,0,0)
            print(c)
